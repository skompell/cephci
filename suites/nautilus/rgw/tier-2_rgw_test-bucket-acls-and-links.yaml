# Objective: Regression suite covering the following features
#             - ACLs
#             - Links
#             - Unlinks
#             - AWS4 Auth
# Conf: 5-node-cluster.yaml
# Platform: RHEL-7
---
tests:
  - test:
      name: install ceph pre-requisites
      module: install_prereq.py
      abort-on-fail: true

  - test:
      name: ceph ansible
      module: test_ansible.py
      config:
        ansi_config:
          ceph_test: True
          ceph_origin: distro
          ceph_repository: rhcs
          osd_scenario: lvm
          osd_auto_discovery: False
          journal_size: 1024
          ceph_stable: True
          ceph_stable_rh_storage: True
          fetch_directory: ~/fetch
          copy_admin_key: true
          dashboard_enabled: False
          ceph_conf_overrides:
            global:
              osd_pool_default_pg_num: 64
              osd_default_pool_size: 2
              osd_pool_default_pgp_num: 64
              mon_max_pg_per_osd: 1024
      desc: test cluster setup using ceph-ansible
      destroy-cluster: false
      abort-on-fail: true

  - test:
      name: check-ceph-health
      module: exec.py
      config:
        cmd: ceph -s
        sudo: true
      desc: Check for ceph health debug info

  # ACLs tests

  - test:
      name: ACLs Test
      desc: Test basic acls
      module: sanity_rgw.py
      config:
        test-version: v1
        script-name: test_acls.py
        config-file-name: test_acls.yaml
        timeout: 300

  - test:
      name: ACLs Test
      desc: Test acls on all users
      module: sanity_rgw.py
      config:
        test-version: v1
        script-name: test_acls_all_usrs.py
        config-file-name: test_acls_all_usrs.yaml
        timeout: 300

  - test:
      name: ACLs Test
      desc: Test acls with copy objects on different users
      module: sanity_rgw.py
      config:
        test-version: v1
        script-name: test_acls_copy_obj.py
        config-file-name: test_acls_copy_obj.yaml
        timeout: 300

  - test:
      name: ACLs Test
      desc: Test acls reset
      module: sanity_rgw.py
      config:
        test-version: v1
        script-name: test_acls_reset.py
        config-file-name: test_acls_reset.yaml
        timeout: 300

  # User, Bucket rename, Bucket link and unlink

  - test:
      name: User rename
      desc: RGW User rename script
      module: sanity_rgw.py
      config:
        script-name: test_user_bucket_rename.py
        config-file-name: test_user_rename.yaml
        timeout: 500

  - test:
      name: Bucket rename
      desc: RGW Bucket rename script
      polarion-id: CEPH-83572908
      module: sanity_rgw.py
      config:
        test-version: v2
        script-name: test_user_bucket_rename.py
        config-file-name: test_bucket_rename.yaml
        timeout: 500

  - test:
      name: Bucket link and unlink
      desc: Bucket move between tenanted and non tenanted users
      polarion-id: CEPH-83572908
      module: sanity_rgw.py
      config:
        test-version: v2
        script-name: test_user_bucket_rename.py
        config-file-name: test_bucket_link_unlink.yaml
        timeout: 500

  # multipart test

  - test:
      name: ACLs Test
      desc: Test multipart upload->cancel->reupload
      module: sanity_rgw.py
      config:
        test-version: v1
        script-name: test_multipart_upload_cancel.py
        config-file-name: test_multipart_upload_cancel.yaml
        timeout: 300

  # AWS4 Auth tests

  - test:
      name: AWS4 Auth test
      desc: AWS4 Auth test
      polarion-id: CEPH-9637
      module: sanity_rgw.py
      config:
        script-name: test_Mbuckets_with_Nobjects.py
        config-file-name: test_Mbuckets_with_Nobjects_aws4.yaml
        timeout: 300

  # REST API test

  - test:
      name: test REST api operation
      desc: test user operation using REST API
      module: sanity_rgw.py
      polarion-id: CEPH-83573505
      config:
        script-name: user_op_using_rest.py
        config-file-name: test_user_with_REST.yaml
        timeout: 300
